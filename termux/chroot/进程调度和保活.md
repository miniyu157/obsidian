这里假设要保活的进程 pid 是 2156
### 查看当前调度状态

查看 cgroup 归属，如果不是根组 `/`，则容易被挂起、冻结

```bash
sudo cat /proc/2156/cgroup
```

查看 nice 值，范围是 -20 到 19，数值越低代表 cpu 调度优先级越高

```bash
sudo ps -o pid,ni,cls,comm -p 2156
```

查看 OOM 分数，范围是 -1000 到 1000，数值越低代表越不容易被杀死，-1000 永不杀死

```bash
sudo cat /proc/2156/oom_score_adj
```

-----

### 解决它

> [!NOTE]
> 必须在宿主系统的 root shell 中执行以下步骤
> 在 chroot 内执行可能无效，因为挂载命名空间和 SELinux 限制会阻止跨层操作

设置 OOM 分数为 -1000，防止被 LMK 杀死

```bash
echo -1000 | sudo tee /proc/2156/oom_score_adj
```

提升 CPU 调度优先级

```bash
sudo renice -n -10 -p 2156
```

调整 cgroup，移入根组

```bash
echo 2156 | sudo tee /dev/cpuctl/cgroup.procs /dev/cpuset/cgroup.procs /dev/memcg/cgroup.procs
```

#### 还是不行

如果上述 cgroup 和 OOM 调整后进程依然被杀，尝试在宿主 `root shell` 中禁用 Android 的 Doze 模式（会增加耗电）：

```bash
dumpsys deviceidle disable
```